<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UmmahConnect - Регистрация</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* СТИЛИ БУДУТ В ФАЙЛЕ 2 */
    </style>
</head>
<body>
    <div class="auth-container">
        <!-- Левый блок с приветствием -->
        <div class="welcome-section">
            <div class="welcome-content">
                <div class="logo">
                    <i class="fas fa-mosque"></i>
                    <h1>UmmahConnect</h1>
                </div>
                <h2>Добро пожаловать в наше сообщество</h2>
                <p>Присоединяйтесь к миллионам мусульман по всему миру. Общайтесь, делитесь знаниями и находите единомышленников.</p>
                
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-users"></i>
                        <span>Сообщество единомышленников</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-book-quran"></i>
                        <span>Исламские знания</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-hands-helping"></i>
                        <span>Взаимопомощь и поддержка</span>
                    </div>
                </div>

                <div class="quran-verse">
                    <p>"Верующие - братья, поэтому примиряйте братьев"</p>
                    <span>Коран, 49:10</span>
                </div>
            </div>
        </div>

        <!-- Правый блок с формами -->
        <div class="form-section">
            <div class="form-container">
                <!-- Шаг 1: Основная регистрация -->
                <div class="form-step active" id="step1">
                    <div class="step-header">
                        <div class="step-indicator">
                            <div class="step active">1</div>
                            <div class="step-line"></div>
                            <div class="step">2</div>
                            <div class="step-line"></div>
                            <div class="step">3</div>
                        </div>
                        <h2>Создание аккаунта</h2>
                        <p>Заполните основную информацию</p>
                    </div>

                    <form id="registerForm">
                        <div class="input-group">
                            <label for="name">
                                <i class="fas fa-user"></i>
                                Полное имя
                            </label>
                            <input type="text" id="name" name="name" required placeholder="Введите ваше полное имя">
                            <div class="error-message" id="nameError"></div>
                        </div>

                        <div class="input-group">
                            <label for="email">
                                <i class="fas fa-envelope"></i>
                                Email адрес
                            </label>
                            <input type="email" id="email" name="email" required placeholder="example@mail.com">
                            <div class="error-message" id="emailError"></div>
                        </div>

                        <div class="input-group">
                            <label for="password">
                                <i class="fas fa-lock"></i>
                                Пароль
                            </label>
                            <input type="password" id="password" name="password" required placeholder="Минимум 8 символов">
                            <div class="error-message" id="passwordError"></div>
                        </div>

                        <div class="input-group">
                            <label for="password_confirmation">
                                <i class="fas fa-lock"></i>
                                Подтверждение пароля
                            </label>
                            <input type="password" id="password_confirmation" name="password_confirmation" required placeholder="Повторите пароль">
                            <div class="error-message" id="passwordConfirmationError"></div>
                        </div>

                        <div class="terms">
                            <input type="checkbox" id="terms" required>
                            <label for="terms">
                                Я принимаю <a href="#">условия использования</a> и <a href="#">политику конфиденциальности</a>
                            </label>
                        </div>

                        <button type="submit" class="btn-primary" id="registerBtn">
                            <span>Продолжить</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </form>

                    <div class="auth-links">
                        <p>Уже есть аккаунт? <a href="#" id="loginLink">Войти</a></p>
                    </div>
                </div>

                <!-- Шаг 2: Подтверждение кода -->
                <div class="form-step" id="step2">
                    <div class="step-header">
                        <div class="step-indicator">
                            <div class="step completed">1</div>
                            <div class="step-line completed"></div>
                            <div class="step active">2</div>
                            <div class="step-line"></div>
                            <div class="step">3</div>
                        </div>
                        <h2>Подтверждение email</h2>
                        <p>Мы отправили код подтверщения на <span id="userEmail"></span></p>
                    </div>

                    <form id="verifyForm">
                        <div class="code-inputs">
                            <input type="text" maxlength="1" class="code-input" data-index="0">
                            <input type="text" maxlength="1" class="code-input" data-index="1">
                            <input type="text" maxlength="1" class="code-input" data-index="2">
                            <input type="text" maxlength="1" class="code-input" data-index="3">
                        </div>
                        <input type="hidden" id="verificationCode" name="code">

                        <div class="error-message" id="codeError"></div>

                        <div class="resend-code">
                            <p>Не получили код? <a href="#" id="resendCode">Отправить повторно</a></p>
                            <div id="countdown">01:00</div>
                        </div>

                        <button type="submit" class="btn-primary" id="verifyBtn">
                            <span>Подтвердить</span>
                            <i class="fas fa-check"></i>
                        </button>

                        <button type="button" class="btn-secondary" id="backToStep1">
                            <i class="fas fa-arrow-left"></i>
                            <span>Назад</span>
                        </button>
                    </form>
                </div>

                <!-- Шаг 3: Успешная регистрация -->
                <div class="form-step" id="step3">
                    <div class="step-header">
                        <div class="step-indicator">
                            <div class="step completed">1</div>
                            <div class="step-line completed"></div>
                            <div class="step completed">2</div>
                            <div class="step-line completed"></div>
                            <div class="step active">3</div>
                        </div>
                        <h2>Добро пожаловать!</h2>
                        <p>Ваш аккаунт успешно создан</p>
                    </div>

                    <div class="success-animation">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3>Аккаунт подтвержден!</h3>
                        <p>Теперь вы полноправный член нашего сообщества</p>
                    </div>

                    <div class="next-steps">
                        <div class="step-card">
                            <i class="fas fa-user-circle"></i>
                            <h4>Заполните профиль</h4>
                            <p>Расскажите о себе сообществу</p>
                        </div>
                        <div class="step-card">
                            <i class="fas fa-users"></i>
                            <h4>Присоединяйтесь к сообществам</h4>
                            <p>Найдите единомышленников</p>
                        </div>
                        <div class="step-card">
                            <i class="fas fa-compass"></i>
                            <h4>Исследуйте платформу</h4>
                            <p>Откройте для себя все возможности</p>
                        </div>
                    </div>

                    <button class="btn-primary" id="goToApp">
                        <span>Перейти в приложение</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="fas fa-check-circle"></i>
            <span id="notificationText"></span>
        </div>
    </div>

    <script>
        // JAVASCRIPT КОД БУДЕТ В ФАЙЛЕ 3
    </script>
</body>
</html>

<style>
    :root {
        --primary: #2e7d32;
        --primary-dark: #1b5e20;
        --primary-light: #4caf50;
        --accent: #ff9800;
        --text: #333333;
        --text-light: #666666;
        --text-lighter: #999999;
        --background: #ffffff;
        --surface: #f8f9fa;
        --border: #e0e0e0;
        --error: #d32f2f;
        --success: #388e3c;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        --radius: 16px;
        --radius-sm: 8px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html, body {
        width: 100%;
        height: 100%;
        overflow-x: hidden;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    }

    .auth-container {
        display: flex;
        min-height: 100vh;
        width: 100%;
    }

    /* Левая секция */
    .welcome-section {
        flex: 1;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }

    .welcome-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        opacity: 0.1;
    }

    .welcome-content {
        max-width: 500px;
        z-index: 1;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 40px;
    }

    .logo i {
        font-size: 40px;
    }

    .logo h1 {
        font-size: 32px;
        font-weight: 700;
    }

    .welcome-content h2 {
        font-size: 32px;
        margin-bottom: 20px;
        font-weight: 600;
        line-height: 1.2;
    }

    .welcome-content p {
        font-size: 18px;
        line-height: 1.6;
        margin-bottom: 40px;
        opacity: 0.9;
    }

    .features {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 40px;
    }

    .feature {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 16px;
    }

    .feature i {
        font-size: 20px;
        color: var(--accent);
    }

    .quran-verse {
        background: rgba(255, 255, 255, 0.1);
        padding: 25px;
        border-radius: var(--radius);
        border-left: 4px solid var(--accent);
    }

    .quran-verse p {
        font-style: italic;
        font-size: 18px;
        margin-bottom: 10px;
        opacity: 1;
    }

    .quran-verse span {
        font-size: 14px;
        opacity: 0.8;
    }

    /* Правая секция */
    .form-section {
        flex: 1;
        background: var(--background);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
    }

    .form-container {
        width: 100%;
        max-width: 450px;
    }

    /* Шаги формы */
    .form-step {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
    }

    .form-step.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Индикатор шагов */
    .step-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
    }

    .step {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--surface);
        color: var(--text-light);
        font-weight: 600;
        border: 2px solid var(--border);
        transition: all 0.3s ease;
    }

    .step.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .step.completed {
        background: var(--success);
        color: white;
        border-color: var(--success);
    }

    .step-line {
        width: 60px;
        height: 2px;
        background: var(--border);
        margin: 0 10px;
        transition: all 0.3s ease;
    }

    .step-line.completed {
        background: var(--success);
    }

    /* Заголовок шага */
    .step-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .step-header h2 {
        font-size: 28px;
        color: var(--text);
        margin-bottom: 10px;
        font-weight: 600;
    }

    .step-header p {
        color: var(--text-light);
        font-size: 16px;
    }

    /* Поля ввода */
    .input-group {
        margin-bottom: 25px;
    }

    .input-group label {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text);
        font-size: 14px;
    }

    .input-group label i {
        color: var(--primary);
        width: 16px;
    }

    .input-group input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: 16px;
        transition: all 0.3s ease;
        background: var(--background);
    }

    .input-group input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
    }

    .input-group input.error {
        border-color: var(--error);
    }

    .error-message {
        color: var(--error);
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }

    .error-message.show {
        display: block;
    }

    /* Чекбокс условий */
    .terms {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 30px;
        padding: 15px;
        background: var(--surface);
        border-radius: var(--radius-sm);
    }

    .terms input[type="checkbox"] {
        margin-top: 2px;
        accent-color: var(--primary);
    }

    .terms label {
        font-size: 14px;
        color: var(--text-light);
        line-height: 1.4;
    }

    .terms a {
        color: var(--primary);
        text-decoration: none;
    }

    .terms a:hover {
        text-decoration: underline;
    }

    /* Кнопки */
    .btn-primary {
        width: 100%;
        padding: 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-sm);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s ease;
        margin-bottom: 20px;
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .btn-primary:disabled {
        background: var(--text-lighter);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .btn-secondary {
        width: 100%;
        padding: 16px;
        background: transparent;
        color: var(--text);
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s ease;
    }

    .btn-secondary:hover {
        border-color: var(--primary);
        color: var(--primary);
    }

    /* Ввод кода */
    .code-inputs {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 25px;
    }

    .code-input {
        width: 60px;
        height: 70px;
        text-align: center;
        font-size: 24px;
        font-weight: 600;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--background);
        transition: all 0.3s ease;
    }

    .code-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
    }

    .code-input.filled {
        border-color: var(--primary);
        background: var(--surface);
    }

    /* Повторная отправка кода */
    .resend-code {
        text-align: center;
        margin-bottom: 30px;
    }

    .resend-code p {
        color: var(--text-light);
        margin-bottom: 10px;
    }

    .resend-code a {
        color: var(--primary);
        text-decoration: none;
        cursor: pointer;
    }

    .resend-code a:hover {
        text-decoration: underline;
    }

    .resend-code a:disabled {
        color: var(--text-lighter);
        cursor: not-allowed;
    }

    #countdown {
        font-size: 14px;
        color: var(--primary);
        font-weight: 600;
    }

    /* Успешная регистрация */
    .success-animation {
        text-align: center;
        margin-bottom: 40px;
    }

    .success-icon {
        width: 80px;
        height: 80px;
        background: var(--success);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        animation: bounce 0.6s ease-in-out;
    }

    .success-icon i {
        font-size: 32px;
        color: white;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
        40% {transform: translateY(-10px);}
        60% {transform: translateY(-5px);}
    }

    .success-animation h3 {
        font-size: 24px;
        color: var(--success);
        margin-bottom: 10px;
    }

    .success-animation p {
        color: var(--text-light);
    }

    /* Следующие шаги */
    .next-steps {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 30px;
    }

    .step-card {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: var(--surface);
        border-radius: var(--radius-sm);
        border-left: 4px solid var(--primary);
    }

    .step-card i {
        font-size: 24px;
        color: var(--primary);
    }

    .step-card h4 {
        font-size: 16px;
        color: var(--text);
        margin-bottom: 5px;
    }

    .step-card p {
        font-size: 14px;
        color: var(--text-light);
    }

    /* Ссылки авторизации */
    .auth-links {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
    }

    .auth-links p {
        color: var(--text-light);
    }

    .auth-links a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
    }

    .auth-links a:hover {
        text-decoration: underline;
    }

    /* Уведомления */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--success);
        color: white;
        padding: 15px 20px;
        border-radius: var(--radius-sm);
        box-shadow: var(--shadow);
        transform: translateX(400px);
        transition: transform 0.3s ease;
        z-index: 1000;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.error {
        background: var(--error);
    }

    .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Адаптивность */
    @media (max-width: 1024px) {
        .auth-container {
            flex-direction: column;
        }

        .welcome-section {
            padding: 40px 20px;
            min-height: 40vh;
        }

        .form-section {
            padding: 40px 20px;
        }

        .welcome-content {
            text-align: center;
            max-width: 100%;
        }

        .features {
            align-items: center;
        }
    }

    @media (max-width: 480px) {
        .welcome-section {
            padding: 30px 15px;
        }

        .form-section {
            padding: 30px 15px;
        }

        .logo h1 {
            font-size: 24px;
        }

        .welcome-content h2 {
            font-size: 24px;
        }

        .step-header h2 {
            font-size: 24px;
        }

        .code-inputs {
            gap: 10px;
        }

        .code-input {
            width: 50px;
            height: 60px;
            font-size: 20px;
        }

        .step-card {
            flex-direction: column;
            text-align: center;
        }
    }

    /* Загрузка */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>

<script>


	// Функция очистки всех ошибок
function clearAllErrors() {
    clearErrors();
    document.getElementById('codeError').classList.remove('show');
}

// И вызывайте ее при смене шагов
function goToStep(stepNumber) {
    document.querySelectorAll('.form-step').forEach(step => {
        step.classList.remove('active');
    });
    
    document.getElementById('step' + stepNumber).classList.add('active');
    clearAllErrors(); // Очищаем ошибки при смене шага
}

    document.addEventListener('DOMContentLoaded', function() {
        // Элементы DOM
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const registerForm = document.getElementById('registerForm');
        const verifyForm = document.getElementById('verifyForm');
        const userEmailSpan = document.getElementById('userEmail');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        // Переменные состояния
        let currentEmail = '';
        let countdownInterval = null;
        let canResend = false;

        // Показать уведомление
        function showNotification(message, isError = false) {
            notificationText.textContent = message;
            notification.classList.add('show');
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Показать ошибку поля
        function showFieldError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            
            errorElement.textContent = message;
            errorElement.classList.add('show');
            inputElement.classList.add('error');
        }

        // Очистить ошибки
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.remove('show');
            });
            document.querySelectorAll('.input-group input').forEach(el => {
                el.classList.remove('error');
            });
        }

        // Переключение шагов
        function goToStep(stepNumber) {
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            
            document.getElementById('step' + stepNumber).classList.add('active');
        }

        // Валидация формы регистрации
        function validateRegisterForm(formData) {
            clearErrors();
            let isValid = true;

            if (!formData.get('name') || formData.get('name').length < 2) {
                showFieldError('name', 'Имя должно содержать минимум 2 символа');
                isValid = false;
            }

            const email = formData.get('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showFieldError('email', 'Введите корректный email адрес');
                isValid = false;
            }

            const password = formData.get('password');
            if (!password || password.length < 8) {
                showFieldError('password', 'Пароль должен содержать минимум 8 символов');
                isValid = false;
            }

            const passwordConfirmation = formData.get('password_confirmation');
            if (password !== passwordConfirmation) {
                showFieldError('passwordConfirmation', 'Пароли не совпадают');
                isValid = false;
            }

            if (!document.getElementById('terms').checked) {
                showNotification('Необходимо принять условия использования', true);
                isValid = false;
            }

            return isValid;
        }

        // Отправка формы регистрации
registerForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const registerBtn = document.getElementById('registerBtn');
    
    if (!validateRegisterForm(formData)) {
        return;
    }

    // Показываем загрузку
    registerBtn.innerHTML = '<div class="loading"></div>';
    registerBtn.disabled = true;

    try {
        const response = await fetch('http://127.0.0.1:8000/api/register/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password'),
                password_confirmation: formData.get('password_confirmation')
            })
        });

        const data = await response.json();

        if (response.ok) {
            currentEmail = formData.get('email');
            userEmailSpan.textContent = currentEmail;
            goToStep(2);
            startCountdown();
            showNotification('Код подтверждения отправлен на вашу почту');
        } else {
            // ОБРАБОТКА ВАШЕГО ФОРМАТА ОШИБОК
            console.log('Error response:', data);
            
            if (data.error) {
                // Ваш формат: {"status":"error","error":"Email in Used"}
                showNotification(data.error, true);
                
                // Показываем ошибку в поле email если это email ошибка
                if (data.error.toLowerCase().includes('email')) {
                    showFieldError('email', data.error);
                }
            } else if (data.errors) {
                // Стандартный формат Laravel
                Object.keys(data.errors).forEach(field => {
                    showFieldError(field, data.errors[field][0]);
                });
            } else if (data.message) {
                showNotification(data.message, true);
            } else {
                showNotification('Произошла ошибка при регистрации', true);
            }
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Ошибка подключения к серверу', true);
    } finally {
        registerBtn.innerHTML = '<span>Продолжить</span><i class="fas fa-arrow-right"></i>';
        registerBtn.disabled = false;
    }
});
        // Обработка ввода кода подтверждения
        const codeInputs = document.querySelectorAll('.code-input');
        const verificationCodeInput = document.getElementById('verificationCode');
        
        codeInputs.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                const value = e.target.value;
                
                if (value.length === 1) {
                    e.target.classList.add('filled');
                    
                    // Переход к следующему полю
                    if (index < codeInputs.length - 1) {
                        codeInputs[index + 1].focus();
                    }
                } else if (value.length === 0) {
                    e.target.classList.remove('filled');
                }
                
                // Обновление скрытого поля с полным кодом
                updateVerificationCode();
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    codeInputs[index - 1].focus();
                }
            });

            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pasteData = e.clipboardData.getData('text');
                const pasteArray = pasteData.split('').slice(0, 4);
                
                pasteArray.forEach((char, pasteIndex) => {
                    if (codeInputs[index + pasteIndex]) {
                        codeInputs[index + pasteIndex].value = char;
                        codeInputs[index + pasteIndex].classList.add('filled');
                    }
                });
                
                if (codeInputs[index + pasteArray.length - 1]) {
                    codeInputs[index + pasteArray.length - 1].focus();
                }
                
                updateVerificationCode();
            });
        });

        function updateVerificationCode() {
            const code = Array.from(codeInputs).map(input => input.value).join('');
            verificationCodeInput.value = code;
        }

        // Отправка кода подтверждения
// Отправка кода подтверждения
verifyForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const code = verificationCodeInput.value;
    const verifyBtn = document.getElementById('verifyBtn');
    
    if (code.length !== 4) {
        showNotification('Введите 4-значный код подтверждения', true);
        return;
    }

    // Показываем загрузку
    verifyBtn.innerHTML = '<div class="loading"></div>';
    verifyBtn.disabled = true;

    try {
        const response = await fetch('http://127.0.0.1:8000/api/register/check-code/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                code: code,
                email: currentEmail
            })
        });

        const data = await response.json();

        if (response.ok) {
            goToStep(3);
            showNotification('Аккаунт успешно подтвержден!');
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
        } else {
            // ОБРАБОТКА ВАШЕГО ФОРМАТА ОШИБОК ДЛЯ ПОДТВЕРЖДЕНИЯ КОДА
            console.log('Error response:', data);
            
            // Сначала очищаем предыдущие ошибки
            document.getElementById('codeError').classList.remove('show');
            
            if (data.error) {
                // Ваш формат: {"status":"error","error":"Invalid Code"} или {"status":"error","error":"Email not found"}
                showNotification(data.error, true);
                document.getElementById('codeError').textContent = data.error;
                document.getElementById('codeError').classList.add('show');
                
                // Если email не найден, возможно нужно вернуться к шагу 1
                if (data.error.toLowerCase().includes('email') && data.error.toLowerCase().includes('not found')) {
                    setTimeout(() => {
                        goToStep(1);
                        showNotification('Пожалуйста, начните регистрацию заново', true);
                    }, 3000);
                }
                
                // Если код неверный, очищаем поля ввода
                if (data.error.toLowerCase().includes('invalid code')) {
                    codeInputs.forEach(input => {
                        input.value = '';
                        input.classList.remove('filled');
                    });
                    codeInputs[0].focus();
                    updateVerificationCode();
                }
            } else if (data.errors) {
                // Стандартный формат Laravel (на всякий случай)
                document.getElementById('codeError').textContent = data.errors.code ? data.errors.code[0] : 'Неверный код';
                document.getElementById('codeError').classList.add('show');
            } else if (data.message) {
                showNotification(data.message, true);
                document.getElementById('codeError').textContent = data.message;
                document.getElementById('codeError').classList.add('show');
            } else {
                showNotification('Неверный код подтверждения', true);
                document.getElementById('codeError').textContent = 'Неверный код подтверждения';
                document.getElementById('codeError').classList.add('show');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Ошибка подключения к серверу', true);
    } finally {
        verifyBtn.innerHTML = '<span>Подтвердить</span><i class="fas fa-check"></i>';
        verifyBtn.disabled = false;
    }
});
        // Повторная отправка кода
// Повторная отправка кода
document.getElementById('resendCode').addEventListener('click', async function(e) {
    e.preventDefault();
    
    if (!canResend) {
        showNotification('Подождите перед повторной отправкой', true);
        return;
    }

    // Показываем загрузку
    const resendLink = document.getElementById('resendCode');
    const originalHtml = resendLink.innerHTML;
    resendLink.innerHTML = '<div class="loading" style="display: inline-block; width: 12px; height: 12px;"></div>';
    resendLink.style.pointerEvents = 'none';

    try {
        const response = await fetch('http://127.0.0.1:8000/api/register/regenerateCode/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: currentEmail
            })
        });

        const data = await response.json();

        if (response.ok) {
            showNotification('Новый код отправлен на вашу почту');
            startCountdown();
        } else {
            // ОБРАБОТКА ВАШЕГО ФОРМАТА ДЛЯ ПОВТОРНОЙ ОТПРАВКИ
            console.log('Error response:', data);
            
            if (data.error) {
                showNotification(data.error, true);
                
                // Если email не найден, возвращаем к шагу 1
                if (data.error.toLowerCase().includes('email') && data.error.toLowerCase().includes('not found')) {
                    setTimeout(() => {
                        goToStep(1);
                    }, 2000);
                }
            } else if (data.message) {
                showNotification(data.message, true);
            } else {
                showNotification('Ошибка при отправке кода', true);
            }
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Ошибка подключения к серверу', true);
    } finally {
        resendLink.innerHTML = originalHtml;
        if (canResend) {
            resendLink.style.pointerEvents = 'auto';
        }
    }
});
        // Обратный отсчет для повторной отправки
        function startCountdown() {
            let timeLeft = 60;
            canResend = false;
            const countdownElement = document.getElementById('countdown');
            const resendLink = document.getElementById('resendCode');
            
            resendLink.style.pointerEvents = 'none';
            resendLink.style.opacity = '0.6';
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    canResend = true;
                    countdownElement.textContent = '';
                    resendLink.style.pointerEvents = 'auto';
                    resendLink.style.opacity = '1';
                }
                
                timeLeft--;
            }, 1000);
        }

        // Навигация назад
        document.getElementById('backToStep1').addEventListener('click', function() {
            goToStep(1);
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
        });

        // Переход в приложение
        document.getElementById('goToApp').addEventListener('click', function() {
            // В реальном приложении здесь будет редирект
            showNotification('Добро пожаловать в UmmahConnect!');
            setTimeout(() => {
                window.location.href = 'index.html'; // Замените на ваш URL
            }, 2000);
        });

        // Ссылка на вход
        document.getElementById('loginLink').addEventListener('click', function(e) {
            e.preventDefault();
            // Здесь можно добавить переход на страницу входа
            showNotification('Функция входа будет доступна скоро');
        });

        // Закрытие уведомления при клике
        notification.addEventListener('click', function() {
            this.classList.remove('show');
        });
    });
</script>
